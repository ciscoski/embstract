# run-pclint

`run-pclint` facilitate running `pclint` on projects.
`pclint` is a static analysis tool for C and C++ code that helps identify potential bugs,
enforce coding standards, and ensure code quality. 

## Requirements

* PCLintPlus >= 2.0

## Using a Compilation Database

`run-pclint` relies on the compilation database generated by CMake and similar tools (`compile_commands.json`).
This database stores information about the compiler flags used for each source file.

## Linting all the code for a target

To perform a full linting analysis on all source files associated with a specific build target, use the following command:

```shell
run-pclint --build-path [target_build_path] lint ./tools/pclint/config/std.lnt [other_options]
```

* `[target_build_path]`: The path to the build directory that contains the `compile_commands.json` file.
* `[other_options]`: (Optional) Additional flags to customize the `run-pclint` behavior. 
Use `run-pclint --help` to view the complete list of available options.

## Monitoring Files for Changes

The script can also be used to continuously monitor files for changes and automatically re-run `pclint` whenever a 
file is modified.
This feature is useful during active development to ensure that code changes remain compliant with the project's 
coding standards.

To start monitoring:

```shell
run-pclint --build-path [target_build_path] watch ./tools/linting/pclint/std.lnt [other-options]
```

* `[target_build_path]`: The path to the build directory that contains the `compile_commands.json` file.
* `[other_options]`: (Optional) Additional flags to customize the `run-pclint` behavior.
Use `run-pclint --help` to view the complete list of available options.

This command sets up file watchers on the relevant files in your project.
Whenever a change is detected in the source code or build-related files, `pclint` is automatically executed to analyze 
the updated files.

## Implementation

### Compiler and Build Environment Detection

The script now automatically extracts necessary information from a JSON file generated by the build tool,
including the compiler name and relevant flags.
This ensures that `pclint` is invoked with the correct settings.
The build tool should generate a JSON file conforming to the schema available at [here](tools/pclint/pclint_compiler_config.schema.json).

The JSON file should include the following fields:

* `compiler`: Specifies the name of a compiler or compiler family from the list of supported compilers as defined by 
`pclp_config.py --list-compiler`.
* `compiler-options`: A space-separated list of base compiler options. 
If you are targeting an architecture other than the compilerâ€™s default, 
you should include the option that specifies the target architecture when generating a compiler configuration to ensure 
the correct values for size options in the generated configuration. 
Compiler options specified with this option are applied when the compiler is invoked in either C or C++ mode.
* `compiler-c-options`: Similar to `compiler-options` but only used when invoking the compiler in C mode. 
Use for C-only language options such as setting the language version.
* `compiler-cpp-options`: Similar to `compiler-options` but only used when invoking the compiler in C++ mode. 
Use for C++-only language options such as setting the language version.
* `compiler-bin`: Specifies the path to the compiler binary.

### Configuration File Generation

The script generates temporary `lnt` configuration files, 
tailored to your specific build environment and project files.
These files are crucial for guiding `pclint` through the analysis process.

### Linting Execution

`pclint` is executed with the following enviornment varialble setup.

* `PCLINT_LNT_PATH`: Path to the `lnt` folder within the pclint installation folder.
Used for standard linting rools like MISRA-C shipped with pclint.
* `PCLINT_TOOLING_PATH`:  Path to the tooling folder, this is `tools/pclint`.
* `PCLINT_COMPILER_FILE_PATH`: Path to the `.lnt` file containing the compiler definition.
* `PCLINT_PROJECT_FILE_PATH`: Path to the `.lnt` file containing the project definition.

These varibles can be used as parameter in the main `.lnt` file (i.e. `tools/pclint/config/std.lnt`).

## CMake integration

A CMake user can include the `pclint_helper.cmake` script to generate compiler configuration files.

```cmake
# PCLint Compiler Configuration
set(PCLINT_HELPER_SCRIPT_PATH ${CMAKE_SOURCE_DIR}/tools/pclint/cmake)
include(${PCLINT_HELPER_SCRIPT_PATH}/pclint_helper.cmake)
generate_pclint_compiler_config()
```

`generate_pclint_compiler_config` expect the following variables to be defined.

| CMake Variable              | Rendered JSON fields | Declaration consideration     |
|-----------------------------|----------------------|-------------------------------|
| PCLINT_COMPILER_NAME        |compiler              | Defined in the toolchain file |
| PCLINT_COMPILER_OPTIONS     |compiler-options      | Defined in the target         |
| PCLINT_COMPILER_C_OPTIONS   |compiler-c-options    | Defined in the target         |
| PCLINT_COMPILER_CPP_OPTIONS |compiler-cpp-options  | Defined in the target         |
| PCLINT_COMPILER_BIN         |compiler-bin          | Defined in the toolchain file |



##  Additional Resources

For further details and advanced configurations, refer to the following resources:

* PCLint website [https://pclintplus.com/](https://pclintplus.com/)
